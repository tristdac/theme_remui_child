{"version":3,"sources":["coursecategory.js"],"names":["define","$","bsselect","templates","toolbar","Ajax","Notification","filterobj","sortfilter","searchfilter","categoryfilter","coursestab","mycoursestab","coursesregion","mycoursesregion","coursespagination","mycoursespagination","togglebtn","gridtemplate","listtemplate","pageheaderactions","generateCourseCards","isFilterModified","show","appendtab","tab","appendpagination","call","methodname","args","data","JSON","stringify","done","response","parse","empty","hasmanagebutton","append","managebuttons","undefined","dropdown","remove","viewobj","view","rendertemplate","latest_card","window","screen","width","addClass","removeClass","courses","length","i","render","then","html","js","appendNodeContents","each","this","content","style","fail","exception","htmldata","pagination","hide","getCourses","updatePage","destroytab","destroypagination","destroyCourseCards","document","ready","_pageobj","_obj","category","sort","search","page","mycourses","initAttributes","initPagination","hash","vars","hashes","location","href","slice","indexOf","split","push","categoryid","categorysort","hasClass","filterdata","selectpicker","val","generateFilters","delegate","attr","on","e","target","value","preventDefault","clckviewbtn","M","util","set_user_preference","linkdata","parentElement"],"mappings":"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","sourcesContent":["\"use strict\";\ndefine([\n    'jquery',\n    'theme_remui/bootstrap-select',\n    'core/templates',\n    'theme_remui/jquery-toolbar',\n    'core/ajax',\n    'core/notification'\n], function($, bsselect, templates, toolbar, Ajax, Notification) {\n\n    // Globals.\n    var filterobj;\n\n    // Filter selectors.\n    var sortfilter = $('select#sortfilter.selectpicker');\n    var searchfilter = $('#coursesearch2');\n    var categoryfilter = $('select#categoryfilter.selectpicker');\n\n    // Tab selector.\n    var coursestab = $('#coursestab');\n    var mycoursestab = $('#mycoursestab');\n\n    // Courses Region Selector.\n    var coursesregion = $('#coursesregion div.content');\n    var mycoursesregion = $('#mycoursesregion div.content');\n\n    // Pagination Selector.\n    var coursespagination = $('#coursespagination');\n    var mycoursespagination = $('#mycoursespagination');\n\n    // View toggler.\n    var togglebtn = $(\".togglebtn\");\n\n    // View templates.\n    var gridtemplate = 'theme_remui/course_card_grid';\n    var listtemplate = 'theme_remui/course_card_list';\n\n    var pageheaderactions = '.page-header-actionss';\n\n    // Initialization of courses.\n    $(document).ready(function() {\n\n        filterobj = categoryFilters(); // Global object for filters.\n        // Initialize global filter object with default values.\n\n        var vars = [],\n        hash;\n        var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');\n        for (var i = 0; i < hashes.length; i++) {\n            hash = hashes[i].split('=');\n            vars.push(hash[0]);\n            vars[hash[0]] = hash[1];\n        }\n\n        if (vars.categoryid && vars.categoryid != 0) {\n            filterobj.category = vars.categoryid;\n        }\n\n        if (vars.categorysort != undefined) {\n            filterobj.sort = vars.categorysort;\n        }\n\n        if (vars.search != undefined) {\n            filterobj.search = vars.search;\n        }\n\n        if (vars.mycourses && vars.mycourses != 0) {\n            filterobj.tab = true;\n            if ($(\"body\").hasClass(\"notloggedin\")) {\n                filterobj.tab = false;\n            }\n        }\n        generateFilters(filterobj); // This will create filters.\n        generateCourseCards(); // Course cards Generation.\n    });\n\n    /**\n     * Filters Generation\n     * @param  {Object} filterdata Filter data\n     */\n    function generateFilters(filterdata) {\n        $(\".selectpicker\").each(function() {\n            $(this).selectpicker();\n        });\n\n        if (filterdata.category !== \"0\") {\n            $(\"#categoryfilter.selectpicker\").selectpicker('val', filterdata.category);\n        }\n\n        if (filterdata.sort !== null) {\n            $(\"#sortfilter.selectpicker\").selectpicker('val', filterdata.sort);\n        }\n\n        if (filterdata.sort !== \"\") {\n            $(\"#coursesearchbox\").val(filterdata.search);\n        }\n\n        // Put animation over here.\n        $(\".category-filters\").removeClass('d-none');\n    }\n\n    /**\n     * Course cards initialization function.\n     */\n    function generateCourseCards() {\n        // Check if Filters are modified and need to fetch the courses.\n        if (!filterobj.isFilterModified) {\n            return;\n        }\n        // Fetch the courses.\n        getCourses();\n    }\n\n    /**\n     * Destroy courses cards\n     */\n    function destroyCourseCards() {\n        // Find active tab to append the course cards.\n        var destroytab = (filterobj.tab) ? mycoursesregion : coursesregion;\n        // Empty the courses region.\n        $(destroytab).empty();\n\n        // Destroy the pagination also.\n        if (filterobj.pagination) {\n            var destroypagination = (filterobj.tab) ? mycoursespagination : coursespagination;\n            $(destroypagination).empty();\n        }\n\n    }\n\n    /**\n     * Main category filters class.\n     * @return {Object} Filter object\n     */\n    function categoryFilters() {\n\n        var _pageobj = {courses: 0, mycourses: 0};\n        var _obj = {\n            // Category id.\n            category: \"3632\",\n            // Sorting.\n            sort: null,\n            // Searching string.\n            search: \"\",\n            // If true, means mycourses tab is active.\n            tab: false,\n            // This object consist of page number that is currently active, has mycourses and all courses tab page number.\n            page: _pageobj,\n            // If True, regenerate the pagination on any action performed.\n            pagination: true,\n            // Initially it is null to detect initial change in view, String grid - view in grid format, String list - list format.\n            view: null,\n            // This filterModified true will tell that we need to fetch the courses otherwise show old fetched data.\n            isFilterModified: true\n        };\n\n        _obj.initAttributes = function() {\n            _obj.category = '3632';\n            _obj.sort = null;\n            _obj.search = '';\n            _obj.tab = false;\n            _obj.page = _pageobj;\n            _obj.pagination = true;\n            _obj.view = null;\n            _obj.isFilterModified = true;\n        };\n\n        _obj.initPagination = function() {\n            _obj.page = {courses: 0, mycourses: 0};\n        };\n        return _obj;\n    }\n\n    /**\n     * Ajax to fetch the course and also append those courses to the page.\n     * If pagination is enabled it will also generate new pagination.\n     */\n    function getCourses() {\n        $('.courses-tabs .courses-loader-wrap').show();\n        // Find active tab to append the course cards.\n        var appendtab = (filterobj.tab) ? mycoursesregion : coursesregion;\n        var appendpagination = (filterobj.tab) ? mycoursespagination : coursespagination;\n        var serviceName = 'theme_remui_get_courses';\n        var getcourses = Ajax.call([{\n            methodname: serviceName,\n            args: {\n                data: JSON.stringify(filterobj)\n            }\n        }]);\n        getcourses[0].done(function(response) {\n            response = JSON.parse(response);\n            $(pageheaderactions).empty();\n            if (response.hasmanagebutton == true) {\n                $(pageheaderactions).append(response.managebuttons);\n            }\n\n            // Show category management dropdown button when user has 'moodle/category:manage' capability.\n            if (response.dropdown != undefined) {\n                $('#page-header .page-header-actionss').append(response.dropdown);\n            } else {\n                $('#page-header .page-header-actionss [data-enhance=\"moodle-core-actionmenu\"]').remove();\n            }\n\n            // Get the view.\n            var viewobj = (filterobj.view === null) ? response.view : filterobj.view;\n\n            // Select the template to render according to view.\n            var rendertemplate = (viewobj == 'grid' || response.latest_card) ? gridtemplate : listtemplate;\n\n            // Always render grid teplate on mobile screen and when latest cards setting is on.\n            if (window.screen.width <= 480 || response.latest_card) {\n                rendertemplate = gridtemplate;\n                viewobj = 'grid';\n            }\n\n            // Update the view.\n            updateView(viewobj);\n\n            updateCards(response.latest_card);\n\n            var courses = response.courses;\n\n            if (courses.length > 0) {\n                for (var i = 0; i < courses.length; i++) {\n                    // This will call the function to load and render our template.\n                    templates.render(rendertemplate, courses[i])\n                    // It returns a promise that needs to be resoved.\n                    /* eslint no-loop-func: 0 */\n                    .then(function(html, js) {\n                        // Here eventually I have my compiled template, and any javascript that it generated.\n                        // The templates object has append, prepend and replace functions.\n                        templates.appendNodeContents(appendtab, html, js);\n\n                        // Show options button on course card.\n                        // check if not mycourse tab.\n                        // This is very bad code, couldn't do it another way.\n                        // it get called each time a single card is added to dom, try to improve it.\n                        if (!filterobj.tab && !response.latest_card) {\n                            /* eslint promise/always-return: 0 */\n                            $('.showoptions').each(function() {\n                                $(this).toolbar({\n                                    content: $(this).data('toolbar'),\n                                    style: 'primary'\n                                });\n                            });\n                        }\n                    }).fail(Notification.exception);\n                }\n\n            } else {\n                var htmldata = '<div class=\"alert alert-warning alert-dismissible  w-full mx-10\" role=\"alert\">';\n                htmldata += '<button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\">' +\n                '<span aria-hidden=\"true\">Ã—</span><span class=\"sr-only\">Close</span></button> No Courses Found</div>';\n                templates.appendNodeContents(appendtab, htmldata, '');\n\n            }\n\n            // Pagination html.\n            // Check if pagination is enabled.\n            if (filterobj.pagination) {\n                templates.appendNodeContents(appendpagination, response.pagination, '');\n            }\n            $('.courses-tabs .courses-loader-wrap').hide();\n        }).fail(Notification.exception);\n    }\n\n    // Actions.\n\n    // This is for, Toolbar redirection not working.\n    $(document).delegate('.tool-item', 'click', function() {\n        window.location = $(this).attr('href');\n    });\n\n    // Category filter.\n    $(categoryfilter).on('changed.bs.select', function(e) {\n        filterobj.category = e.target.value;\n        filterobj.initPagination();\n        updatePage();\n    });\n    // Sorting Filter.\n    $(sortfilter).on('changed.bs.select', function(e) {\n        filterobj.sort = e.target.value;\n        updatePage();\n    });\n    // Course Tab Selector.\n    $(coursestab).on('click', function() {\n        filterobj.tab = false;\n        updatePage();\n    });\n    // My Course Tab Selector.\n    $(mycoursestab).on('click', function() {\n        filterobj.tab = true;\n        updatePage();\n    });\n\n    // Search Filter.\n    $(searchfilter).on('submit', function(e) {\n        e.preventDefault();\n        filterobj.initPagination();\n        filterobj.search = $('#coursesearchbox').val();\n        updatePage();\n    });\n\n    // View toggler.\n    $(togglebtn).on('click', function() {\n        var clckviewbtn = $(this).attr('data-view');\n        filterobj.view = clckviewbtn;\n        M.util.set_user_preference('course_view_state', clckviewbtn, null);\n        updatePage();\n    });\n\n    /**\n     * This function is commented because no one is going to resize the screen.\n     * @param  {String} view View typ\n     */\n    function updateView(view) {\n        if (view == 'grid') {\n            filterobj.view = 'grid';\n            $('.tab-content').addClass('grid-view').removeClass('list-view');\n            $('.grid_btn').addClass('btn-primary active');\n            $('.list_btn').removeClass('btn-primary active');\n        } else {\n            filterobj.view = 'list';\n            $('.tab-content').addClass('list-view').removeClass('grid-view');\n            $('.grid_btn').removeClass('btn-primary active');\n            $('.list_btn').addClass('btn-primary active');\n        }\n    }\n\n    /**\n     * Update cards view\n     * @param  {Boolean} latest True if want to show as latest card\n     */\n    function updateCards(latest) {\n        if (latest) {\n            $('.tab-content').addClass('latest-cards');\n            $('.viewtoggler').addClass('hidden');\n        } else {\n            $('.tab-content').removeClass('latest-cards');\n            $('.viewtoggler').removeClass('hidden');\n        }\n    }\n\n    // Pagination Click Event.\n    $(document).delegate('.tab-pane .pagination .page-item .page-link', 'click', function(e) {\n        e.preventDefault();\n        // Update the page number in object for mycourses as well as all courses tab.\n        var linkdata = e.target.href;\n        if (linkdata === undefined) {\n            linkdata = e.target.parentElement.href;\n            if (linkdata === undefined) {\n                linkdata = e.target.parentElement.parentElement.href;\n            }\n        }\n\n        var hashes = linkdata.slice(linkdata.indexOf('?') + 1).split('&');\n        var vars = [],\n        hash;\n        for (var i = 0; i < hashes.length; i++) {\n            hash = hashes[i].split('=');\n            vars.push(hash[0]);\n            vars[hash[0]] = hash[1];\n        }\n\n        if (filterobj.tab) {\n            filterobj.page.mycourses = vars.page;\n        } else {\n            filterobj.page.courses = vars.page;\n        }\n\n        updatePage();\n    });\n\n    /**\n     * Update page content\n     */\n    function updatePage() {\n        // Destroy the cards from page.\n        destroyCourseCards();\n        // Create courses cards again.\n        generateCourseCards();\n    }\n\n});\n"],"file":"coursecategory.min.js"}